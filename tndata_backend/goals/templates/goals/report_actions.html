{% extends "goals/base.html" %}
{% load static from staticfiles %}
{% load goal_filters %}
{% load goal_tags %}
{% load util_tags %}


{% block head %}
  {{ block.super }}
  <script src="{% static 'js/Chart.min.js' %}"></script>
  <style type="text/css">
    canvas {
      display: block;
      margin: .5em auto;
      width: 200px;
      height: 200px;
    }
  </style>
{% endblock %}


{% block breadcrumbs %}
  <li><a href="{% url 'goals:reports' %}">Reports</a></li>
  <li class="current">Notifications</li>
{% endblock %}


{% block content %}
<div class="row">
  <div class="larg-12 columns">
    <h1>Notifications <small>{{ total }} total</small></h1>
    <p class="lead">Information about our Notification (aka Action) content.</p>
  </div>
</div>

<div class="row">
  <div class="large-8 medium-8 small-12 columns">
    <h2 class="secondary">Sub-reports</h2>
    <ul>
      <li><a href="?sub=desc">Notifications with long text descriptions</a></li>
      <li><a href="?sub=notif">Notifications with long notification text</a></li>
    </ul>

    {% if actions %}
    <h3>
      {{ subreport_title }}
      <small>{{ actions.count }} notifications.</small>
    </h3>
    <p>View content longer than:
      {% for opt in len_options %}
        {% if opt == max_len %}
          {{ opt }} {% if not forloop.last %} | {% endif %}
        {% else %}
          <a href="?len={{ opt }}&amp;sub={{subreport}}">{{ opt }}</a>
          {% if not forloop.last %} | {% endif %}
        {% endif %}
      {% endfor %}
      characters.
    </p>
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Text Length</th>
          <th>Behavior</th>
        </tr>
      </thead>
      <tbody>
      {% for action in actions %}
        {% with behavior=action.behavior %}
        <tr>
          <td>
            <a href="{{ action.get_absolute_url }}">{{ action }}</a>
            <i data-tooltip aria-haspopup="true"
               {% if subreport == "desc" %}
                title="{{ action.description }}"
               {% elif subreport == "notif" %}
                title="{{ action.notification_text }}"
               {% endif %}
               class="tip-top fa fa-info-circle"></i>
          </td>
          <td>{{ action.text_len }}</td>
          <td>
            <a href="{{ behavior.get_absolute_url }}">{{ behavior }}</a>
          </td>
        </tr>
        {% endwith %}
      {% endfor %}
      </tbody>
    </table>
    {% else %}
      <p>There is no content whose character
         count is greater than {{ max_len }}.</p>
      <p>Find content longer than:
        {% for opt in len_options %}
          {% if opt == max_len %}
            {{ opt }} {% if not forloop.last %} | {% endif %}
          {% else %}
            <a href="?len={{ opt }}&amp;sub={{subreport}}">{{ opt }}</a>
            {% if not forloop.last %} | {% endif %}
          {% endif %}
        {% endfor %}
      </p>
    {% endif %}
  </div> {# end .columns #}

  <div class="large-4 medium-4 small-12 columns">
    <h2>States
      <small><a href="#" data-reveal-id="pop-state-modal">Data</a></small>
    </h2>
    <p>The current states for all notification content.</p>

    {# Modal showing a table w/ numbers #}
    <div id="pop-state-modal" class="reveal-modal"
         data-reveal aria-labelledby="state-data" aria-hidden="true" role="dialog">
      <h2 id="state-data">Notifcation States</h2>
        <table style="width:100%">
          <thead><tr><th>State</th><th>Count</th></tr></thead>
          <tbody>
            <tr><td>Draft</td><td>{{ draft_count }}</td></tr>
            <tr><td>Published</td><td>{{ published_count }}</td></tr>
            <tr><td>Pending Review</td><td>{{ pendingreview_count }}</td></tr>
            <tr><td>Declined</td><td>{{ declined_count }}</td></tr>
          </tbody>
        </table>
      <a class="close-reveal-modal" aria-label="Close">&#215;</a>
    </div>

    <canvas id="state-counts"></canvas>
    <script>
    // Get the context of the canvas element we want to select
    var ctx = document.getElementById("state-counts").getContext("2d");
    var data = [
      {
        value: {{ draft_count }},
        color: "#e7e7e7",
        highlight: "#e9e9e9",
        label: "Draft"
      },
      {
        value: {{ published_count }},
        color: "#43AC6A",
        highlight: "#368a55",
        label: "Published"
      },
      {
        value: {{ pendingreview_count }},
        color: "#f08a24",
        highlight: "#cf6e0e",
        label: "Pending Review"
      },
      {
        value: {{ declined_count }},
        color: "#f04124",
        highlight: "#cf2a0e",
        label: "Declined"
      }
    ]
    var c = new Chart(ctx).Doughnut(data);
    </script>
  </div> {# end .columns #}

</div> {# end .rows #}
{% endblock %}
