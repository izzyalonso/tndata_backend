{% extends "goals/base.html" %}

{% block head %}
  {{ block.super }}
  {# Custom CSS for behavior lists in the side panel #}
  <style type="text/css">
  #behavior-info{display: none;}
  </style>
{% endblock %}


{% block content %}
<ul class="breadcrumbs">
  <li><a href="{% url 'goals:index' %}">Home</a></li>
  <li><a href="{% url 'goals:action-list' %}">Actions</a></li>
  <li class="current">
    {% if object %}{{ action }}{% else %}New Action {% endif %}
  </li>
</ul>

<h1>{% if object %}Update Action: {{object }}{% else %}Create Action{% endif %}</h1>
<div class="row">
  <div class="large-6 small-12 columns">
    <form action="{% if object %}{{ object.get_update_url }}{% else %}{% url 'goals:action-create' %}{% endif %}" method="post" enctype="multipart/form-data">{% csrf_token %}
    <p>An <strong>Action</strong> is the unit of activity in which
    users will engage.</p>
    {{ form.as_p }}
    <hr/>
    {% if object %}
      <button type="submit">Update Action</button>
    {% else %}
      <button type="submit">Create Action</button>
    {% endif %}
    </form>
  </div>
  <div class="large-6 small-12 columns">
    <div id="behavior-info" class="panel">
      <h2>Behavior</h2>
      {% for behavior in behaviors %}
        <div class="behaviors" id="behavior-{{behavior.id}}">
          {{behavior.informal_list|linebreaks}}
        </div>
      {% endfor %}
    </div>
    <p>The structure of our data looks something like the following:</p>
    <pre class="panel">
Category
  - Goal
  -- Behavior
  --- Action 1
  --- Action 2
    </pre>
    <table>
      <caption>Existing Actions</caption>
      <thead>
        <tr><th>Order</th><th>Behavior</th><th>Title</th></tr>
      </thead>
      <tbody>
      {% for action in actions %}
        <tr>
          <td>{{ action.sequence_order }}</td>
          <td>{{ action.behavior }}</td>
          <td><a href="{{ action.get_absolute_url }}">{{ action }}</a></td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block bodyjs %}
  {{ block.super }}
  <script>
  var toggle_behavior_details = function(selector) {
      $("#behavior-info").show();
      $(".behaviors").hide(); // hide all other behaviors.
      $(selector).show(); // show the selected one.
      $("#behavior-info h2").text($("#id_behavior option:selected").text());
  }

  $(document).ready(function() {
    $("#id_behavior").change(function() {
      var selected_id = "#behavior-" + $(this).val();
      toggle_behavior_details(selected_id);
    });

    // Show any pre-selected behaviors.
    var selected_id = $("#id_behavior").val();
    if(selected_id) {
      selected_id = "#behavior-" + selected_id;
      toggle_behavior_details(selected_id);
    };
  });
  </script>
{% endblock %}
