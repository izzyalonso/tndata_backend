{% extends "goals/base.html" %}
{% load goal_tags %}
{% load goal_filters %}
{% load util_tags %}
{% load util_filters %}

{% block title %}C: {{ category.title }}{% endblock %}

{% block breadcrumbs %}
    <li><a href="{% url 'goals:category-list' %}">Categories</a></li>
    <li class="current">{{ category }}</li>
{% endblock %}

{% block content %}
  <div class="row">
    <div class="large-6 small-12 columns">
      <h1>
        {% if category.is_packaged %}Package: {% endif %}
        {{ category }} {% goal_object_controls category %}</h1>
      <dl>
        <dt>State</dt><dd>
          {{ category|label }}
          {% if category.is_packaged %}
            <span class="label info">Package</span>
          {% endif %}
        </dd>
        <dt>Default Order</dt><dd>{{ category.order }}</dd>
        <dt>Description</dt><dd>{{ category.description|markdown }}</dd>
        <dt>Icon</dt><dd class="gray centered">
          {% with icon=category.get_absolute_icon %}
          {% if icon %}
            <a href="{{ icon }}" target="_blank">
            <img src="{{ icon }}" alt="{{ category }} icon" />
            </a>
            <p class="panel">
              {% if category.icon %}
              Image details: {{ category.icon|details }}<br/>
              {% endif %}
              Location: <a href="{{ icon }}">{{ icon|truncatechars:40 }}</a>
            </p>
          {% else %}
            <em>No icon available</em>
          {% endif %}
          {% endwith %}
        </dd>
        <dt>Hero Image</dt><dd>
          {% with image=category.get_absolute_image %}
          {% if image %}
            <a href="{{ image }}" target="_blank">
            <img src="{{ image }}" alt="{{ category }} image" />
            </a>
            <p class="panel callout">
              Image details: {{ category.image|details }}<br/>
              Location: <small><a href="{{ image }}">{{ image }}</a></small>
            </p>
          {% else %}
            <em>No image available</em>
          {% endif %}
          {% endwith %}
        </dd>
        <dt>Color</dt><dd>
          <span style="display:inline-block;width:22px;height:22px;background-color:{{category.color}};">
          </span>
          {{ category.color }}
         </dd>
        <dt>Secondary Color</dt><dd>
          <span style="display:inline-block;width:22px;height:22px;background-color:{{category.secondary_color|default:'#ccc'}};">
          </span>
          {{ category.secondary_color|default:"not set" }}
         </dd>
      </dl>
      {% if category.is_packaged %}

      <h2 class="subheader">Package Details</h2>
      <dl>
        <dt>Package Contributors</dt>
        <dd>
          {% for contributor in category.package_contributors.all %}
            {{ contributor.get_full_name }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </dd>
        <dt>Prevent Custom Triggers default</dt>
        <dd>{{ category.prevent_custom_triggers_default|iconbool }}</dd>
        <dt>Display the Prevent Custom Triggers Option during enrollment</dt>
        <dd>{{ category.display_prevent_custom_triggers_option|iconbool }}</dt>
        <dt>Consent Summary</dt><dd>
          <div class="panel">{{ category.rendered_consent_summary|safe }}</div>
        </dd>
        <dt>Consent More Info</dt><dd>
          <div class="panel">{{ category.rendered_consent_more|safe }}</div>
        </dd>
      </dl>
      {% endif %}

      {% modified category %}
      {% if perms.goals.publish_category %}{% publish_deny_form category %}{% endif %}
    </div>
    <div class="large-6 small-12 columns">
      {% if category.notes %}
        <h2 class="subheader">Notes</h2>
        <div class="panel">{{ category.notes|markdown }}</div>
      {% endif %}
      <h2 class="subheader">Content</h2>
      <p><strong>{{ category }}</strong>
        contains the following Goals, Behaviors, and Actions:</p>
      <ul class="accordion" data-accordion>
      {% for goal in category.goals %}
        <li class="accordion-navigation clearfix">
          <a href="#goal-{{goal.id}}"><div class="pull-right">{{ goal|label }}</div> {{ goal }}</a>
          <div id="goal-{{ goal.id }}" class="content{% if forloop.first %} active{% endif %}">
          {% for bs in goal.behavior_set.all %}
            <dl>
              <dt class="clearfix">
                <div class="pull-right">{{ bs|label }}</div>
                <a href="{{ bs.get_absolute_url }}">{{bs}}</a>
              </dt>
              <dd class="clearfix">
                <ul>
                {% for ba in bs.action_set.all %}
                  <li>
                    <div class="pull-right">{{ba|label}}</div>
                    <a href="{{ ba.get_absolute_url }}">{{ ba }}</a>
                  </li>
                {% empty %}
                  <li><em>There are no actions in this behavior</em></li>
                {% endfor %}
                </ul>
              </dd>
            </dl>
          {% empty %}
            <em>There are no Behaviors/Actions in this Goal.</em>
          {% endfor %}
          </div>
        </li>
      {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}
